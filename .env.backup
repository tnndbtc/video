# =============================================================================
# BeatStitch Configuration
# =============================================================================
#
# Copy this file to .env and customize the values.
# Run: cp .env.example .env
#
# IMPORTANT: In production, you MUST change SECRET_KEY to a secure random value!
# Generate one with: openssl rand -hex 32
#
# For full documentation, see: docs/deployment.md
#
# =============================================================================

# -----------------------------------------------------------------------------
# APPLICATION
# -----------------------------------------------------------------------------

# Secret key for JWT token signing.
# CRITICAL: Change this in production! Use a 32+ character random string.
# Generate with: openssl rand -hex 32
# Example: openssl rand -hex 32 | pbcopy  (copies to clipboard on macOS)
SECRET_KEY=95f650855624bbd38d92218e494368cbb8258ed45318eb485aa36acc6797f435

# Enable debug mode. Set to 'false' in production.
# Debug mode enables:
# - Detailed error messages in API responses
# - Auto-reload on code changes (development)
# - Additional logging output
# - Interactive error pages
DEBUG=false

# Application version (displayed in health check and UI)
VERSION=0.1.0

# -----------------------------------------------------------------------------
# DATABASE
# -----------------------------------------------------------------------------

# SQLite database URL.
# Format: sqlite:////absolute/path/to/database.db (note the 4 slashes)
#
# The database file is stored in the Docker volume at /data/db/
# For local development without Docker, use a relative path:
#   DATABASE_URL=sqlite:///./beatstitch.db
#
# For PostgreSQL (Phase 2):
#   DATABASE_URL=postgresql://user:password@host:5432/beatstitch
DATABASE_URL=sqlite:////data/db/beatstitch.db

# -----------------------------------------------------------------------------
# REDIS
# -----------------------------------------------------------------------------

# Redis connection URL for the job queue.
# Format: redis://[user:password@]host:port/database
#
# Default uses Redis container with no authentication.
# For production with password:
#   REDIS_URL=redis://:yourpassword@redis:6379/0
#
# For Redis Sentinel (high availability):
#   REDIS_URL=redis-sentinel://sentinel1:26379,sentinel2:26379/mymaster/0
REDIS_URL=redis://redis:6379/0

# -----------------------------------------------------------------------------
# STORAGE
# -----------------------------------------------------------------------------

# Base path for file storage.
# All uploads, derived files, and outputs are stored under this path.
#
# Directory structure:
#   /data/
#   |-- db/beatstitch.db                # SQLite database
#   |-- uploads/{project_id}/
#   |   |-- media/                      # Original uploaded images/videos
#   |   +-- audio/                      # Original audio tracks
#   |-- derived/{project_id}/
#   |   |-- beats.json                  # Beat analysis results (authoritative)
#   |   |-- edl.json                    # Timeline/EDL (authoritative)
#   |   |-- thumbnails/                 # Generated thumbnails
#   |   +-- proxies/                    # Low-res proxy files
#   |-- outputs/{project_id}/
#   |   |-- preview/                    # Preview renders
#   |   +-- final/                      # Final renders
#   +-- temp/                           # Temporary render files (ephemeral)
STORAGE_PATH=/data

# Maximum file upload size in bytes.
# Default: 500MB (524288000 bytes)
#
# IMPORTANT: If using a reverse proxy (nginx/Caddy), configure it to match!
# See: docs/deployment.md#reverse-proxy-setup
#
# Common values:
#   100MB = 104857600
#   500MB = 524288000
#   1GB   = 1073741824
#   2GB   = 2147483648
MAX_UPLOAD_SIZE=524288000

# -----------------------------------------------------------------------------
# API / FRONTEND
# -----------------------------------------------------------------------------

# API URL for the frontend to connect to.
#
# For Docker Compose development:
#   Leave empty - frontend connects to backend directly on port 8000
#   API_URL=
#
# For reverse proxy setup (recommended for production):
#   Frontend and API served from same domain through reverse proxy
#   API_URL=/api
#
# For separate frontend/backend servers (not recommended):
#   API_URL=https://api.beatstitch.example.com
#
# NEVER use http://localhost or 127.0.0.1 in production!
API_URL=

# CORS allowed origins (comma-separated for multiple domains).
# Specifies which origins are allowed to make cross-origin API requests.
#
# Development (single origin):
#   CORS_ORIGINS=http://localhost:3000
#
# Production (single domain):
#   CORS_ORIGINS=https://beatstitch.example.com
#
# Production (with www subdomain):
#   CORS_ORIGINS=https://beatstitch.example.com,https://www.beatstitch.example.com
#
# WARNING: Do not use * in production as it allows any origin!
CORS_ORIGINS=http://localhost:3000

# -----------------------------------------------------------------------------
# JWT / AUTHENTICATION
# -----------------------------------------------------------------------------

# Access token expiration time in hours.
# After this time, users must log in again.
#
# Default: 24 hours (reasonable for most use cases)
#
# Considerations:
# - Shorter (1-4 hours): Higher security, more frequent logins
# - Longer (72-168 hours): Convenience, lower security
# - For shared/public computers, use shorter expiration
ACCESS_TOKEN_EXPIRE_HOURS=24

# -----------------------------------------------------------------------------
# PRODUCTION SETTINGS
# -----------------------------------------------------------------------------

# Domain for production deployment.
# Used by Caddy for automatic HTTPS and by the application for URL generation.
#
# Development:
#   DOMAIN=localhost
#
# Production:
#   DOMAIN=beatstitch.example.com
DOMAIN=localhost

# Frontend API URL (relative path for same-origin requests through reverse proxy)
# This is used to build the production frontend with the correct API path.
VITE_API_URL=/api

# -----------------------------------------------------------------------------
# RATE LIMITING
# -----------------------------------------------------------------------------

# Enable/disable rate limiting.
# Recommended: true in production to prevent abuse
# Set to false only for development/testing
RATE_LIMIT_ENABLED=true

# Rate limit settings (requests per window):
# RATE_LIMIT_UPLOAD=10         # 10 uploads per minute per user
# RATE_LIMIT_RENDER=5          # 5 render requests per 5 minutes per user
# RATE_LIMIT_ANALYZE=10        # 10 analysis requests per minute per user
# RATE_LIMIT_DEFAULT=100       # 100 general requests per minute per user

# -----------------------------------------------------------------------------
# LOGGING
# -----------------------------------------------------------------------------

# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
# - DEBUG: Verbose, includes all details (development only)
# - INFO: Standard operation logging (recommended for production)
# - WARNING: Only warnings and errors
# - ERROR: Only errors
LOG_LEVEL=INFO

# Log format: json, text
# - json: Structured JSON logs (recommended for production, easier to parse)
# - text: Human-readable logs (better for development)
# LOG_FORMAT=json

# -----------------------------------------------------------------------------
# JOB QUEUE SETTINGS (advanced)
# -----------------------------------------------------------------------------
# These control worker job behavior. Defaults are suitable for most deployments.

# Job timeout settings (in seconds)
# Jobs are killed if they exceed these timeouts.
# JOB_TIMEOUT_BEAT_ANALYSIS=300      # 5 minutes for beat detection
# JOB_TIMEOUT_TIMELINE=60            # 1 minute for timeline generation
# JOB_TIMEOUT_MEDIA_PROCESSING=120   # 2 minutes for thumbnail/metadata
# JOB_TIMEOUT_RENDER_PREVIEW=600     # 10 minutes for preview render
# JOB_TIMEOUT_RENDER_FINAL=1800      # 30 minutes for final render

# -----------------------------------------------------------------------------
# RESOURCE LIMITS (advanced)
# -----------------------------------------------------------------------------
# These settings control resource usage and prevent abuse.

# Maximum media items per project
# MAX_MEDIA_PER_PROJECT=50

# Maximum projects per user
# MAX_PROJECTS_PER_USER=20

# Maximum video clip duration (seconds)
# MAX_VIDEO_DURATION=600              # 10 minutes

# Maximum segment count per timeline
# Larger values may cause FFmpeg filter graph issues
# MAX_SEGMENTS_PER_RENDER=200
